================================================================================
==
==  DLWアクセスランプ Version 1.5.1 (2015.6.13)
==
==  (C) 2013-2015 hnx8(H.Takahashi)
==    http://hp.vector.co.jp/authors/VA055804/DLw/
==    http://d.hatena.ne.jp/hnx8/
==
================================================================================

【１】DLWアクセスランプ について

 「DLWアクセスランプ」は、ディスクドライブ・LAN・ワイヤレスLANのアクセス状態
 （ディスクアクセス／ネットワーク送受信の有無）やキーロック状態を監視し、
 タスクトレイ通知領域アイコンでLEDのように表示するユーティリティソフトです。
 HDDアクセスランプがついていないノートPC・タブレットPCなどに導入すると便利です。

 ＜特徴＞
 ・シンプル・低CPU負荷ですが、最低限のカスタマイズができるようになっています。
 ・初期設定不要で使用できます。デフォルトでは、Caps/Scroll/NumLockキー状態
   および状態確認可能な全ドライブ・LAN・無線LANが表示対象です。
   不要な項目はカスタマイズで非表示にできます。
 ・設定オプション画面より簡単操作でスタートアップ起動に登録できます。

 ・ドライブ名もアイコンに表示されます。
 ・２ドライブ分のアクセス状態を１アイコンに表示し、省スペースです。
   パーティションを切ったドライブは集約表示ON/OFFも可能です。(Ver1.4以降）
 ・状態表示アイコンについて、目立ちすぎず、かつアクセス状態を確実に視認できる
   よう配慮しています。アイコンデザインもカスタマイズ可能です。

 ・ドライブの接続／取り外しを検知し、タスクトレイ表示を自動的に更新します。
   表示自動更新をオフにすることもできます。
 ・外付けUSBメモリ、一部のRAMディスクについてもアクセス状態を表示できます。
   （WindowsXPでは固定ディスクのみ表示）
 ・Caps/Scroll/NumLockキーロック状態も表示ON/OFF可能です。(Ver1.3以降)
   キーロック状態を固定にしたり、マウス操作でキーロック状態変更もできます。

 ・トレイアイコンをクリックすると、各ドライブ等の読み込み／書き込みバイト数の
   累計が確認できます。(Ver1.1以降)


【２】動作環境

 WindowsXP以降。（Microsoft .NET Framework 2.0 または 4.0/4.5系）

 WindowsXP、WindowsVista、Windows7、Windows8.1で動作確認しています。
 WindowsServer2003／2008／2012における動作は未確認ですが、
 .NET Framework2.0などがインストール済であれば問題なく動くと思われます。


【３】インストール・バージョンアップ・アンインストール

 特にインストール作業は不要です。
 ダウンロードしたファイルを解凍し、DLW.exeを適当なフォルダに置いて
 実行して下さい。

 バージョンアップは、新しいバージョンのDLW.exeを
 古いバージョンのDLW.exeが置かれているフォルダに上書きするだけでOKです。
 旧バージョンでの設定内容も自動的に引き継がれます。

 アンインストール時は、DLW.exeを削除してください。

 設定ファイルは以下の(環境変数%LOCALAPPDATA%配下の)フォルダに保存されます。
 不要な場合削除してください。

   C:\Users\(ユーザー名)\AppData\Local\DLW
   ※WindowsXP以前は、C:\Documents and Settings\(ユーザー名)\Local Settings\Application Data\DLW

 レジストリは、このアプリケーションとしては使用しておりません。
 （キーロック操作無効化もレジストリ不使用です）

 ただし通知領域に表示したアイコンの履歴に関する情報は、
 Windowsの仕様によりレジストリに残ってしまいます。
 アイコン履歴は以下のレジストリキーに格納されていますが、
 レジストリの書き換えは危険を伴う作業なので不用意に更新しないでください。

   HKEY_CURRENT_USER\Software\Classes\Local Settings\Software\Microsoft\Windows\CurrentVersion\TrayNotify


【４】起動方法

 DLW.exeをダブルクリックするなどして起動してください。
 ドライブ名／LAN種類が書かれたアイコンがタスクトレイに追加され、
 各ドライブのアクセス有無／ネットワーク送受信有無がリアルタイムで表示されます。

 ※Windows8環境などでは、起動時に「.NET Framework 3.5(2.0)の機能が必要です」と
   メッセージが表示されることがあります。
   解凍ファイルに含まれる「DLW.exe.config」をDLW.exeと同じディレクトリに配置
   するか、メッセージ表示された機能を有効化すると、起動できるようになります。


【５】終了方法

 タスクトレイのアイコンを右クリックし、メニューから[終了(X)]を選択してください。
 常駐を終了し、タスクトレイからアイコンが消えます。


【６】設定カスタマイズ

 DLWのアイコンを右クリックし、メニューから[設定(T)]を選択すると、
 設定カスタマイズ画面が表示されます。
 以下の項目を設定できます。

 (1)ドライブ表示対象

   ディスクアクセス有無の監視・表示対象となるドライブをカスタマイズできます。

   ・「自動設定」を選択している場合は、DLW起動時・トレイ表示リフレッシュ時に
     （「ドライブ着脱時にリフレッシュ」チェックOnの場合はドライブ着脱時も）
     チェックされている種類の全ドライブを自動検出し、タスクトレイに表示します。
   ・表示対象外としたいドライブがあれば、「除外ドライブ」に
     "DQ"などと半角アルファベットでドライブ名の文字を入力してください。

   ・「ドライブ名指定」を選択した場合は、
     表示対象とするドライブをテキスト入力欄で指定します。
     "CDE"などと半角アルファベットでドライブ名の文字を入力してください。

 (2)LAN表示対象

   LANの通信状態を表示するか否か、表示対象とするLANアダプタの種類を
   カスタマイズできます。

   ・「LAN」「無線LAN」のチェックボックスで表示On/Offを指定します。
     ただし、PCに該当するLANアダプタが搭載されていない場合は、チェックOn/Offの
     変更はできません。

   <上級者向け設定>
   ・「Broadcast受信パケットは無視」をOnにすると、
     ブロードキャストパケット受信時にはトレイアイコンを点灯せず、
     自PC宛の通信を受信したときのみ受信点灯表示するようになります。
     ※IPmsg等のメッセンジャーソフトを使用している場合など、ネットワーク内の
       すべてのPC等をあて先とした通信データが頻繁に飛び交っているLAN環境では、
       このチェックをOnにするほうが実用的です。

   <上級者向け設定>
   ・「一部LANを別表示」をOnにした場合は、特定のLANアダプタの状態を
     通常のLANアイコンとは別のアイコンで表示します。
     指定したキーワードがLANアダプタの名前・デバイス名に含まれていれば
     そのLANアダプタは「l」「w」ではなく「v」のアイコンで状態表示されます。
        キーワード例1 - VMWareの仮想LANを別表示とする場合：「VMnet」
        キーワード例2 - VirtualBox仮想LANを別表示とする場合：「Virtual」
        キーワード例3 - VPN接続を別表示とする場合：「VPN」
     ※主に仮想LAN環境での利用を想定した機能です。

 (3)Caps/Scroll/NumLockキー
 
   キーロック状態を表示するか否か、また各ロックキーの状態を固定するかについて
   カスタマイズできます。

   ・「キーロック状態表示」をOnにすると、各キーロックのON/off状態が
     １個目のアイコンの左半分に表示されます。
     （キー種類の文字が、キーロックONなら色つき／offならグレーで表示されます）
     アイコンにマウスを乗せると、キーロック状態がテキストで表示されます。

     また、トレイアイコンの右クリックメニューに「キーロックON/OFF」が追加され、
     マウス操作により各ロックキーの状態を変更できるようになります。

   ・Caps/Scroll/NumLkキー無効化のチェックボックスをOnにした場合、
     該当のキーロック操作が行われると、直後にそのキー操作を取り消します。
     これにより、キーロック操作を実質的に無効化、キーロック状態を固定します。
     （DLWアクセスランプを起動してる間だけ有効です）
     起動中にキーロックを変更する場合は、右クリックメニューから操作可能です。
     
   ・キーロック無効化のチェックをOnにした場合、チェック右側のコンボボックスで
     各キーのロック初期状態を指定できます。
     DLWアクセスランプ起動時／設定更新時に反映されます。
     （「(制御なし)」を選択している場合は、特に設定変更は行いません）

 (4)タスクトレイ表示設定

   タスクトレイの表示更新間隔・表示色を設定できます。

   ・アクセス状況表示の更新間隔を、「更新間隔ミリ秒」欄でミリ秒(1/1000秒)単位で
     指定してください。
   ・また、アクセスがあった瞬間から「延長表示ミリ秒」で指定された間、
     ドライブ名の外枠だけが色つきで表示されます。

   ・「xxx秒毎にドライブ着脱検知」で指定した秒数ごとに、各ドライブの接続有無を
     確認し、新たにマウントされたドライブがあればグレーアウト表示を解除します。
   ・「ドライブ着脱時にリフレッシュ」で、ドライブの取り外し・マウントに連動し
     タスクトレイに一覧表示されるドライブ等を自動リフレッシュするか否かを
     指定します。チェックがOffの場合、自動リフレッシュは行われません。

   ・「複数パーティション集約表示」のチェックがONの場合は、
     複数パーティションのディスクの状態を１アイコン表示にまとめて表示します。
     OFFにすると、ドライブごとに別々のアイコン表示となります。
     （ドライブ名は、コンボボックスで指定した書式でアンダーライン表示されます）

 (5)アイコンデザイン

   アイコンの表示色・文字フォントを設定変更できます。
   ※フォントは等幅フォントのみ指定可能です。

   ・プルダウンリストで変更したい色・フォントの種類を選択し、
     「変更」ボタンをクリックすると、色・フォント選択ダイアログが表示されます。
     （またプルダウンリスト上での右クリックでも、ダイアログが表示されます）
     お好みのデザインを設定してください。

   ・ドライブ名・LAN種類文字の影の濃さは、「影」の数字で調節できます。
   ・アイコンランプの張り出し具合は、「凸凹」の数値で調節できます。
     （プラス値なら凸、マイナス値では凹っぽく表示されます）

   「アイコンデザイン」欄には、現在の表示設定によるアイコン表示イメージが
   プレビュー表示されます。

 (6)起動ショートカット作成

   デスクトップ／スタートアップ／WindowsVista以前のクイック起動バー(QuickLaunch)
   にショートカットを作成できます。

   ・各チェックボックスのOn/Offを変更すると、該当のショートカットを作成／削除
     するか確認ダイアログが表示されます。
     「はい(Y)」を選択すると、実際にショートカットファイルが作成／削除されます。

 なお、起動時に表示される「ディスクドライブおよびLAN／無線LANのアクセス有無を
 タスクトレイに表示します。」のバルーンは、設定ウィンドウで設定変更・保存を
 行うことで、表示されなくなります。


【７】アイコン表示仕様について

 タスクトレイアイコンは、初期状態デフォルト設定では、以下のように表示されます。

  (1)ドライブ名の文字は、英大文字で白色表示されます。
     LAN／無線LANは、英小文字で「l」「w」と表示されます。

     監視不能なドライブ等（取り外されたりして有効ではない場合など）の
     文字色は、薄いグレーになります。

     １台のディスクに複数のパーティションが切られている場合は、
     そのディスクの先頭ドライブ名が下線つきで表示されます。

     Caps/Scroll/NumLockキー状態は、キーロックONの場合「c」「s」「n」が
     色つきで表示されます。

  (2)ドライブ等の状態は、一定時間（100ミリ秒）ごとに更新されます。
     直前の表示更新以降に、ドライブ・ネットワークの読み出し／書き込みが
     行われたか否かをもとに表示色を決定します。

    ・読み出しありのドライブは、背景色グリーンで表示されます。
    ・書き込みありのドライブは、背景色オレンジで表示されます。
    ・読み出し＆書き込みを同時に行っている間は、
      背景の上半分がグリーン／下半分がオレンジで表示されます。

    ・LAN／無線LANは、受信中：水色、送信中：ピンクで表示されます。

    ・アクセスしていないときは、背景色グレーで表示されます。
    ・ただし最後の読み出し／書き込み検出のあと一定時間内（400ミリ秒）は、
      背景のうち外枠が該当色、内側はグレーで表示されます。

    ※複数パーティション下線表示のドライブは、
      いずれかのパーティションで読み書きがあれば色つきで表示されます。

  (3)トレイアイコンにマウスを乗せると、
     『 DLWアクセスランプ [ そのアイコンでの監視ドライブ名等 ] 』
     とツールチップが表示されます。

  (4)トレイアイコンを左クリックすると、以下の内容をポップアップ表示します。
     （アイコン右クリック－[累計表示(S)]を選択した場合も同様です）

    ・DLWを起動（もしくは表示をリフレッシュ）した時刻と経過時間
    ・ドライブ／LAN種類ごとの読込／書込（送受信）バイト数累計の一覧

 トレイアイコンを右クリックし、メニューから[リフレッシュ(U)]を選択すると、
 その時点での最新のドライブ等接続有無をもとに、タスクトレイに表示する
 ドライブ等の一覧をリフレッシュします。
 この操作を行うと、監視開始時刻、読込／書込バイト数累計がリセットされます。

 ※USBデバイス（USBメモリ・USBハードディスク等）を着脱した場合なども
   自動リフレッシュが行われ、監視対象のドライブが追加／削除されます。
 ※LANアダプタを着脱したことによりアイコン表示対象が増減する場合も、
   同様に自動リフレッシュが行われます。


【８】制約事項について ＜2015/01時点＞

 (1)ディスクドライブの種類は、Windows標準のAPIに頼った簡易識別しか行っていない
    ため、実際のドライブ種類どおりに検出されないことがあります。

   ・USBポータブルハードディスクのほとんどは、リムーバブルディスクではなく
     固定ディスクとして認識されます。
   ・RAMディスクは、使用しているデバイスドライバ／ドライブ設定により
     大半のものが固定ディスク／リムーバブルディスクとして認識されます。
     （「一部のRAMディスク」で認識できるものは、現状ほとんどありません）

 (2)OSのパフォーマンスカウンタからアクセス状況を取得できないドライブは、
    手動設定でドライブ名を指定しても状態表示できません。

    ・CD/DVDドライブ、ネットワークドライブは状態表示できません。
    ・RAMディスクは、デバイスドライバが未対応のものは状態表示できません。
      （2013/09時点では、「Dataram RAMDisk 4.2」「SoftPerfect RAM Disk v3.4」
        については表示可能なことを確認しています。
        対応RAMディスクソフトの一覧は、Web上で情報提供予定です）
    ・WindowsXPでは、USBリムーバブルディスク／RAMディスクは状態表示できません。
    ⇒いずれの場合も、累計表示時には
     「監視不能(パフォーマンスカウンタ取得不能)」と表示されます。

    ・WindowsVistaにて、管理者権限（または「Performance Monitor Users」権限）
      を持たないユーザでDLWを起動した場合、各ドライブの状態表示はできません。
    ⇒累計には「監視不能(パフォーマンスカウンタ参照権限なし)」と表示されます。

    ・OSのパフォーマンスカウンタが破損している環境では、状態表示できません。
    ⇒累計には「監視不能(パフォーマンスカウンタ破損)」と表示されます。
      （パフォーマンスカウンタの修復を行う必要があります）

 (3)フロッピーディスクドライブ(FDD)は状態表示できません。
    ⇒累計には「Floppy」と表示されます。

 (4)一部の古い無線LANアダプタは、Ethernetアダプタとして認識されてしまうため
    LAN種類「w」ではなく「l」と表示されることがあります。

 (5)日本語版以外のWindowsでは、アプリケーション名・ディスクアクセス等累計は
    英語で表示されます。（全角文字を表示しようとすると文字化けしてしまうため）

 (6)アクセス状態の表示は、タスクバーの通知領域アイコンにて行っています。
    高負荷時などタスクバーが「応答なし」になっていると、表示が更新されません。


【９】著作権・使用規定

 本ソフトDLWの著作権は、作者である私、hnx8(H.Takahashi)が有しています。
 このソフトはフリーウェアです。ご自由にお使いください。
 （企業内での使用についても特に制約はありません）

 本ソフトを使用することで発生したいかなる損害についても作者はその責を負いません。

 複写・再配布も自由です。
 ただし、インターネット上のWebサイトへのバイナリ転載ないしそれに類する行為に
 ついては、事前に作者へ許可を求めてください。


【10】サポート・連絡先

 連絡、ご意見ご感想、要望や不具合報告については、
 作者が開設しているBLOG（ http://d.hatena.ne.jp/hnx8/ ）にて
 コメント等いただければと思います。
 
 ※作者所有の（HDDアクセスランプがない）PC向けに作ったツールが
   母体となっております。
   作者の環境で動作確認できない改善要望・不具合については、
   おそらく対応できません。


【11】更新履歴

■Ver 1.5.1(2015.06.13)
・24.9日以上読み書き実績のないドライブ/ネットワークでランプが常時外枠点灯状態
  になる不具合を修正
・ソースコードを同梱

■Ver 1.5.0(2015.01.03)
・複数パーティション集約表示時の表示ラベルをカスタマイズできるよう機能追加
・一部のLANアダプタを別ラベルで状態表示できるよう機能追加
・上記に伴う設定ウィンドウの項目追加・見直し

・マルチセッションログイン時（WindowsServerやVisualStudioシミュレータ環境等）
  セッションごとに別起動できるよう対応

■Ver 1.4.3(2014.12.24)
・物理ディスク１台のドライブパーティションを３つ以上に分割している場合に
  エラーが発生する不具合を修正

■Ver 1.4.2(2014.11.08)
・.NET Framework2.0を有効化していない環境でも起動できるよう、設定ファイルを追加
・設定ファイル破損時にエラーメッセージを表示するよう対応
・マルチセッションでのログイン時（Windows8.xのVisualStudioシミュレータ環境等）
  エラーとなる不具合を暫定回避
・更新間隔デフォルト設定値を見直し（監視間隔50ms→100ms、残照300ms→400ms）

■Ver 1.4.1(2014.09.26)
・キーロック状態固定機能のBugFix
  ・キーロック変更操作の取り消しが時々空振りする不具合を修正
  ・キーロック取り消しアクションを１回だけピンポイントに実行するよう挙動改善

■Ver 1.4.0(2014.09.21)
・複数パーティション集約表示機能を追加
  （複数パーティションのディスクを１マスにまとめて下線表示）
・上記に伴う設定ウィンドウの項目追加・見直し
  監視対象デフォルト設定にキーロック状態・パーティション集約表示も含めるよう変更
・アイコンを右詰め表示するよう仕様変更、リムーバブルディスクのマウント時に
  アイコン位置が極力ズレないように対応
・その他内部構造の改善、Readme記述の最新化等

■Ver 1.3.4(2014.08.05)
・スタートアップ起動時にHRESULT:0x80010002エラーが発生する不具合を修正
（ずらっちさん、バグ報告ありがとうございました）

■Ver 1.3.3(2014.05.19)
・ネットワークの送受信有無チェック時にエラーが発生することがある不具合を修正
・異常終了時に「プログラムは動作を終了しました」が極力出力されないよう修正
（deconさん、バグ報告ありがとうございました）

■Ver 1.3.2(2013.12.22)
・ドライブ文字影の描画位置のズレ(Ver1.3.1混入分)を修正、および描画改善

■Ver 1.3.1(2013.12.07)
・ドライブの種類が判定できなかった場合にエラーとなる不具合を修正
・アプリケーションアイコンを更新

■Ver 1.3.0(2013.12.01)
・Caps/ScrollLock/NumLockキーの状態表示・キーロック状態変更、
  およびキーロック操作無効化機能を追加
・上記に伴う設定ウィンドウの項目追加・見直し

・高DPI環境(DPIスケーリング≠100%)でアイコン文字崩れしていたのを修正
・監視対象ドライブなしの場合、累計表示にエラーメッセージが表示されていたのを修正
・Alt+F4押下でタスクトレイアイコンが閉じてしまわないよう、さらに対策
・右クリックメニューのツールヒントが点滅を繰り返す不具合について、対策実施

■Ver 1.2.5(2013.10.29)
・スタートアップ起動時などに、まれにタスクトレイアイコンが表示されないことがある
  不具合を修正（Shell_NotifyIconの4秒タイムアウト問題対応）
・アイコンリフレッシュ時にエラーになることがありそうなので、更新前アイコンの
  監視停止待ち時間の最大値を100ms→1000msに変更
  また1000ms待ってもダメだった場合にエラー画面が表示されないよう修正試行
・Alt+F4押下でタスクトレイアイコンが閉じられた場合の自動復旧方法を改善
・日本語版以外のOSではメニューを英語表記で表示するよう、念のため修正

■Ver 1.2.4(2013.10.08)
・フロッピーディスクドライブを識別し、監視を行わないようにする処理を追加、
  一定時間ごとにFDDドライブが動き出してしまう不具合を修正
・日本語版以外のWindowsでは累計表示などを英語で表示するよう修正
（ねこねこさん、いわたさん、不具合報告ありがとうございました！）

・Windowsログオンユーザ名によってはDLWが起動できない不具合を修正
・設定ウィンドウの見た目を微調整、ドライブ文字黒影／白影設定を自動化

■Ver 1.2.3(2013.09.21)
・Windowsクラシックテーマの場合に設定ウィンドウで文字欠けしていた箇所を修正
・選択したフォントによってはアイコン文字の表示位置がおかしくなるのを、極力改善
・アイコンのランプ表示につき、凸表示をデフォルトの設定に変更

■Ver 1.2.2(2013.09.05)
・読込中の書込延長表示／書込中の読込延長表示ができない不具合(Ver1.2.0混入)を修正
・アイコンフォントの影強調設定がアイコンに反映されていない不具合を修正
・アイコン自体の表示凸凹設定を変更可能に

■Ver 1.2.1(2013.09.02)
・WindowsXP・固定IP環境にて休止状態から復帰した際にLANアダプタが監視不能となる
  不具合を修正
・大半のRAMディスクについて、ただしく識別できない／アクセス監視できないことに
  気づいたため、設定画面の表記／Readme記述内容を大幅に修正
・エラー発生時のダイアログ表示内容を改善、問題発生箇所特定用の情報を付加

■Ver 1.2.0(2013.08.24)
・Ethernet/無線LAN両方有効なら、常にネットワークで１アイコンを表示するように改善
・ディスクアクセス／ネットワーク送受信のトレイ表示色を別々に設定できるよう対応
・ドライブ名・LAN種類の文字フォント、および影の濃さを設定できるよう対応、
  ドライブ文字の視認性を改善
・設定ウィンドウでトレイアイコンをプレビュー表示できるよう対応
・アイコン左クリックの表示（読込／書込ないし送信／受信バイト数累計表示）を調整、
  休止・サスペンドしている時間は起動時間計に含めないよう対応
・初回起動／バージョンアップ後起動時、バルーンメッセージを表示するように対応
・起動時間（のうちアイコンが表示されるまでの時間）を短縮  

・複数のネットワーク接続を有効にしている場合、２つ目以降のネットワーク接続／切断
  を検知できない不具合(Ver1.1.0混入)を修正
・設定ファイル(user.config)破損時に起動できない問題を回避するよう修正
・Alt+F4押下でタスクトレイアイコンが閉じられた場合に自動復旧するよう改善

■Ver 1.1.0(2013.08.04) 
・ドライブごとの読込／書込バイト数累計表示機能を追加
・RAMディスクも自動検出対象ドライブ種類に追加(Vista以降で監視可能)
・OSパフォーマンスカウンタ破損時、パフォーマンスカウンタ参照不能時に
  起動エラーとならないよう対応
・トレイ表示リフレッシュ時・二重起動時、ごくまれにエラーが発生する不具合を修正
・エラー発生時のログ出力先ディレクトリを、設定ファイル保存先と同一に変更
・これらに伴い、プログラム内部構造を全般的に見直し改善
・ソフト名を「DLw」→「DLWアクセスランプ」に統一
（どりぱぱさん、不具合報告＆動作確認報告＆機能要望ありがとうございました！
  色々取り込んでみました）

■Ver 1.0.3(2013.07.14)
・二重起動制御を改善（既に起動済ならトレイアイコン再表示、バルーンチップを表示）

■Ver 1.0.2(2013.07.10)
・設定ウィンドウのレイアウトを整理
・ブロードキャスト受信パケットを無視する機能を追加

■Ver 1.0.0.1(2013.06.30)
・初回リリースバージョン
・起動直後のリムーバブルディスクの取り外し・マウントに追随できない不具合を修正

■初期開発(2013/06/下旬)
・開発着手。Thinkpad Edge E430c向けに母体機能作成
